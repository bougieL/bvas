!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Bvas=e()}(this,function(){"use strict";var r=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},i=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),n=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},g=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var i=[],n=!0,r=!1,s=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done)&&(i.push(o.value),!e||i.length!==e);n=!0);}catch(t){r=!0,s=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw s}}return i}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},l=function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)};function o(t,e){t.classList.add(e)}var t=function(){function n(t){var e=t.el,i=t.disableCursor;t.disableEvents;r(this,n),this.$el=document.querySelector(e),this.$canvas=document.createElement("canvas"),this.$canvas.width=this.$el.offsetWidth,this.$canvas.height=this.$el.offsetHeight,o(this.$el,"bvas-wrapper"),o(this.$canvas,"bvas-viewport"),this.$ctx=this.$canvas.getContext("2d"),this.$el.append(this.$canvas),this.$layers=[],i||this.$canvas.addEventListener("mousemove",this._cursor.bind(this))}return i(n,[{key:"addLayer",value:function(t){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this.$layers.push(t),e&&this._render()}},{key:"removeLayer",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this.$layers=this.$layers.filter(function(t){return t!==e}),t&&this._render()}},{key:"clear",value:function(){this.$ctx.clearRect(0,0,this.$canvas.width,this.$canvas.height)}},{key:"getViewport",value:function(){return this.$canvas}},{key:"_sort",value:function(){this.$layers.sort(function(t,e){return t.$style.zIndex-e.$style.zIndex})}},{key:"_cursor",value:function(e){var i=this;this.clear();var n=null;this._sort(),this.$layers.forEach(function(t){t._sort(),t.$shapes.forEach(function(t){t._render(),i.$ctx.isPointInPath(e.offsetX,e.offsetY,"evenodd")&&(n=t.$style.cursor)})}),this.$canvas.style.cursor=n}},{key:"_events",value:function(){var i=this;this._sort(),this.$layers.forEach(function(t){t._sort(),t.$shapes.forEach(function(t){t._render(),i.$ctx.isPointInPath(e.offsetX,e.offsetY)&&(cursor=t.$style.cursor)})}),this.$canvas.style.cursor=cursor}},{key:"_render",value:function(){this.clear(),this._sort(),this.$layers.forEach(function(t){t._render()})}}]),n}(),a=function(){function n(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.style,i=t.props;r(this,n),this.$style=e,this.$props=i,this.$shapes=[],this.$bvas=null,this.$ctx=null,this.$canvas=null}return i(n,[{key:"addTo",value:function(t){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return this.$canvas=t.$canvas,this.$ctx=t.$ctx,(this.$bvas=t).addLayer(this,e),this}},{key:"addShape",value:function(t){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return this.$bvas.removeLayer(this,!1),this.$shapes.push(t),this.$bvas.addLayer(this,e),this}},{key:"removeShape",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return this.$bvas.removeLayer(this,!1),this.$shapes=this.$shapes.filter(function(t){return t!==e}),this.$bvas.addLayer(this,t),this}},{key:"remove",value:function(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];return this.$bvas.removeLayer(this,t),this}},{key:"_sort",value:function(){this.$shapes.sort(function(t,e){return t.$style.zIndex-e.$style.zIndex})}},{key:"_render",value:function(){this._sort(),this.$shapes.forEach(function(t){t._render()})}}]),n}();function h(t,e){var i,n,r,s,o,a,h,u,l,c,f,v,y,d,$,p,_,b,k,x=(n=(i=e).position,r=i.radius,s=g(n,2),o=s[0],a=s[1],[[o-r,a-r],[o+r,a+r]]);return h=t,u=g(x,2),l=g(u[0],2),c=l[0],f=l[1],v=g(u[1],2),y=v[0],d=v[1],$=g(h,2),p=$[0],_=$[1],!(p<c||y<p||_<f||d<_)&&(b=t,k=e.position,!(Math.sqrt(Math.pow(b[0]-k[0],2)+Math.pow(b[1]-k[1],2))>e.radius))}t.Layer=a;var u=function(){function n(t){var e=t.style,i=t.props;r(this,n),this.$style=e,this.$props=i,this.$layer=null,this.$ctx=null,this.$canvas=null,this.$bvas=null,this.$events=[]}return i(n,[{key:"addTo",value:function(t){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return this.$canvas=t.$canvas,this.$layer=t,this.$ctx=t.$ctx,this.$bvas=t.$bvas,t.addShape(this,e),this}},{key:"setStyle",value:function(t){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return this.$layer.removeShape(this,!1),this.$style=t,this.$layer.addShape(this,e),this}},{key:"on",value:function(t,e){var i=this,n=function(t){(function(t,e){if(e instanceof v){var i=e.$style;return h(t,{position:i.position,radius:i.size})}if(e instanceof y){var n=e.$style;return h(t,{position:n.position,radius:n.radius})}})([t.offsetX,t.offsetY],i)&&e(i,t)};this.$events.push({evType:t,func:n,fn:e}),this.$canvas.addEventListener(t,n)}},{key:"un",value:function(e,i){var n=this;this.$events=this.$events.filter(function(t){if(t.evType===e&&t.fn===i)return n.$canvas.removeEventListener(e,t.func),!0})}},{key:"remove",value:function(){return this.$layer.removeShape(this),this}},{key:"getStyle",value:function(){return this.$style}},{key:"getBound",value:function(){return function(t){if(t instanceof v){var e=t.$style,i=e.position,n=e.size,r=g(i,2),s=r[0],o=r[1];return[[s-n,o-n],[s+n,o+n]]}if(t instanceof y){var a=t.$style,h=a.position,u=a.radius,l=g(h,2),c=l[0],f=l[1];return[[c-u,f-u],[c+u,f+u]]}if(t instanceof d||t instanceof $)return function(t){var e=void 0,i=void 0,n=void 0,r=void 0;for(var s in t){var o=t[s][0],a=t[s][1];0==s?(e=n=o,i=r=a):(e=o<e?o:e,n=n<o?o:n,i=a<i?a:i,r=r<a?a:r)}return[[e,i],[n,r]]}(t.$style.points)}(this)}},{key:"_rotate",value:function(){var t=this.$ctx,e=this.$style,i=e.rotate,n=e.rotateCenter;if(!n){var r=this.getBound(),s=g(r,2),o=g(s[0],2),a=o[0],h=o[1],u=g(s[1],2);n=[(a+u[0])/2,(h+u[1])/2]}t.translate.apply(t,l(n)),t.rotate(i)}}]),n}(),v=function(t){function e(){return r(this,e),s(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return n(e,u),i(e,[{key:"_render",value:function(){var t=this.$style,e=t.position,i=t.size,n=void 0===i?2:i,r=t.color,s=void 0===r?"#000":r;this.$ctx.beginPath(),this.$ctx.arc(e[0],e[1],n,0,2*Math.PI),this.$ctx.fillStyle=s,this.$ctx.fill(),this.$ctx.closePath()}}]),e}(),y=function(t){function e(){return r(this,e),s(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return n(e,u),i(e,[{key:"_render",value:function(){var t=this.$style,e=t.position,i=t.radius,n=t.strokeStyle,r=void 0===n?"#000":n,s=t.fillStyle,o=void 0===s?"#000":s,a=t.strokeWidth,h=void 0===a?1:a,u=t.startAngle,l=void 0===u?0:u,c=t.endAngle,f=void 0===c?2*Math.PI:c,v=t.counterclockwise,y=void 0===v||v;this.$ctx.beginPath(),this.$ctx.arc(e[0],e[1],i,l,f,y),this.$ctx.fillStyle=o,this.$ctx.strokeStyle=r,this.$ctx.lineWidth=h,this.$ctx.fill(),this.$ctx.stroke(),this.$ctx.closePath()}}]),e}(),d=function(t){function e(){return r(this,e),s(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return n(e,u),i(e,[{key:"_render",value:function(){var t=this.$style,e=this.$ctx,i=t.points,n=t.strokeStyle,r=void 0===n?"#000":n,s=t.strokeWidth,o=void 0===s?1:s;e.beginPath(),e.moveTo.apply(e,l(i[0])),i.forEach(function(t){e.lineTo.apply(e,l(t))}),e.strokeStyle=r,e.lineWidth=o,e.stroke(),e.closePath()}}]),e}(),$=function(t){function e(){return r(this,e),s(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return n(e,u),i(e,[{key:"_render",value:function(){var t=this.$style,e=t.points,i=t.strokeStyle,n=void 0===i?"#000":i,r=t.strokeWidth,s=void 0===r?1:r,o=t.fillStyle,a=void 0===o?"#000":o,h=this.$ctx;h.save(),h.rotate(Math.PI/20),h.beginPath(),h.moveTo.apply(h,l(e[0])),e.forEach(function(t){h.lineTo.apply(h,l(t))}),h.lineTo.apply(h,l(e[0])),h.strokeStyle=n,h.lineWidth=s,h.fillStyle=a,h.stroke(),h.fill(),h.closePath(),h.restore()}}]),e}();return t.Point=v,t.Circle=y,t.PolyLine=d,t.PolyGon=$,t});
